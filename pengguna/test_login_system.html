<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Sistem Login Permanen - UPTD Tekkom</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-section {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .danger { background: #dc3545; }
        .danger:hover { background: #c82333; }
        .success-btn { background: #28a745; }
        .success-btn:hover { background: #218838; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .storage-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
        }
        .storage-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }
    </style>
</head>
<body>
    <h1>üß™ Test Sistem Login Permanen</h1>
    <p>Halaman ini untuk menguji fitur login permanen yang telah dibuat.</p>

    <div class="test-container">
        <h2>üìã Status Sistem</h2>
        <div id="systemStatus" class="test-section">
            <p>Memeriksa status sistem...</p>
        </div>
    </div>

    <div class="test-container">
        <h2>üíæ Test LocalStorage</h2>
        <div class="test-section">
            <h3>1. Cek LocalStorage Support</h3>
            <div id="localStorageTest"></div>
            <button onclick="testLocalStorage()">Test LocalStorage</button>
        </div>

        <div class="test-section">
            <h3>2. Cek SessionStorage Support</h3>
            <div id="sessionStorageTest"></div>
            <button onclick="testSessionStorage()">Test SessionStorage</button>
        </div>

        <div class="test-section">
            <h3>3. Cek Data Tersimpan</h3>
            <div id="storedDataTest"></div>
            <button onclick="checkStoredData()">Cek Data Tersimpan</button>
            <button onclick="clearAllStorage()" class="danger">Clear All Storage</button>
        </div>
    </div>

    <div class="test-container">
        <h2>üîê Test Login System</h2>
        <div class="test-section">
            <h3>1. Simulasi Login</h3>
            <input type="text" id="testUserName" placeholder="Masukkan nama user" value="Test User">
            <button onclick="simulateLogin()" class="success-btn">Simulasi Login</button>
            <div id="loginTestResult"></div>
        </div>

        <div class="test-section">
            <h3>2. Test Auto-Login</h3>
            <button onclick="testAutoLogin()">Test Auto-Login</button>
            <div id="autoLoginTestResult"></div>
        </div>

        <div class="test-section">
            <h3>3. Test Logout</h3>
            <button onclick="simulateLogout()" class="danger">Simulasi Logout</button>
            <div id="logoutTestResult"></div>
        </div>
    </div>

    <div class="test-container">
        <h2>üìä Informasi Storage</h2>
        <div class="storage-info">
            <div class="storage-item">
                <h4>LocalStorage</h4>
                <div id="localStorageInfo"></div>
            </div>
            <div class="storage-item">
                <h4>SessionStorage</h4>
                <div id="sessionStorageInfo"></div>
            </div>
        </div>
        <button onclick="refreshStorageInfo()">Refresh Info</button>
    </div>

    <div class="test-container">
        <h2>üîç Debug Console</h2>
        <div class="test-section">
            <h3>Console Logs</h3>
            <div id="consoleLogs" style="max-height: 300px; overflow-y: auto; background: #000; color: #0f0; padding: 10px; font-family: monospace;"></div>
            <button onclick="clearConsole()">Clear Console</button>
        </div>
    </div>

    <script>
        // Override console.log untuk menampilkan di halaman
        const originalConsoleLog = console.log;
        const consoleLogsDiv = document.getElementById('consoleLogs');
        
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            const logEntry = document.createElement('div');
            logEntry.textContent = new Date().toLocaleTimeString() + ': ' + args.join(' ');
            consoleLogsDiv.appendChild(logEntry);
            consoleLogsDiv.scrollTop = consoleLogsDiv.scrollHeight;
        };

        // Test LocalStorage
        function testLocalStorage() {
            const resultDiv = document.getElementById('localStorageTest');
            try {
                localStorage.setItem('test', 'test-value');
                const testValue = localStorage.getItem('test');
                localStorage.removeItem('test');
                
                if (testValue === 'test-value') {
                    resultDiv.innerHTML = '<div class="test-result success">‚úÖ LocalStorage berfungsi dengan baik</div>';
                } else {
                    resultDiv.innerHTML = '<div class="test-result error">‚ùå LocalStorage tidak berfungsi</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<div class="test-result error">‚ùå LocalStorage error: ' + error.message + '</div>';
            }
        }

        // Test SessionStorage
        function testSessionStorage() {
            const resultDiv = document.getElementById('sessionStorageTest');
            try {
                sessionStorage.setItem('test', 'test-value');
                const testValue = sessionStorage.getItem('test');
                sessionStorage.removeItem('test');
                
                if (testValue === 'test-value') {
                    resultDiv.innerHTML = '<div class="test-result success">‚úÖ SessionStorage berfungsi dengan baik</div>';
                } else {
                    resultDiv.innerHTML = '<div class="test-result error">‚ùå SessionStorage tidak berfungsi</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<div class="test-result error">‚ùå SessionStorage error: ' + error.message + '</div>';
            }
        }

        // Check stored data
        function checkStoredData() {
            const resultDiv = document.getElementById('storedDataTest');
            const userSession = localStorage.getItem('userSession');
            const sessionStorage = sessionStorage.getItem('userSession');
            
            let html = '<div class="test-result info">üìä Data Storage:</div>';
            
            if (userSession) {
                try {
                    const data = JSON.parse(userSession);
                    html += '<div class="test-result success">‚úÖ LocalStorage: ' + data.userName + ' (Login: ' + new Date(data.loginTime).toLocaleString() + ')</div>';
                } catch (e) {
                    html += '<div class="test-result error">‚ùå LocalStorage: Data corrupt</div>';
                }
            } else {
                html += '<div class="test-result warning">‚ö†Ô∏è LocalStorage: Tidak ada data</div>';
            }
            
            if (sessionStorage) {
                try {
                    const data = JSON.parse(sessionStorage);
                    html += '<div class="test-result success">‚úÖ SessionStorage: ' + data.userName + ' (Login: ' + new Date(data.loginTime).toLocaleString() + ')</div>';
                } catch (e) {
                    html += '<div class="test-result error">‚ùå SessionStorage: Data corrupt</div>';
                }
            } else {
                html += '<div class="test-result warning">‚ö†Ô∏è SessionStorage: Tidak ada data</div>';
            }
            
            resultDiv.innerHTML = html;
        }

        // Clear all storage
        function clearAllStorage() {
            if (confirm('Yakin ingin menghapus semua data storage?')) {
                localStorage.clear();
                sessionStorage.clear();
                console.log('üßπ Semua storage telah dibersihkan');
                checkStoredData();
                refreshStorageInfo();
            }
        }

        // Simulate login
        function simulateLogin() {
            const userName = document.getElementById('testUserName').value || 'Test User';
            const resultDiv = document.getElementById('loginTestResult');
            
            const sessionData = {
                userName: userName,
                loginTime: new Date().toLocaleString(),
                timestamp: Date.now(),
                isLoggedIn: true,
                permanent: true,
                sessionId: 'test-session-' + Date.now(),
                lastActivity: Date.now()
            };
            
            try {
                localStorage.setItem('userSession', JSON.stringify(sessionData));
                sessionStorage.setItem('userSession', JSON.stringify(sessionData));
                
                resultDiv.innerHTML = '<div class="test-result success">‚úÖ Login berhasil: ' + userName + '</div>';
                console.log('üîê Simulasi login berhasil:', sessionData);
                
                checkStoredData();
                refreshStorageInfo();
            } catch (error) {
                resultDiv.innerHTML = '<div class="test-result error">‚ùå Login gagal: ' + error.message + '</div>';
            }
        }

        // Test auto-login
        function testAutoLogin() {
            const resultDiv = document.getElementById('autoLoginTestResult');
            const storedSession = localStorage.getItem('userSession');
            
            if (storedSession) {
                try {
                    const data = JSON.parse(storedSession);
                    const now = Date.now();
                    const lastActivity = data.lastActivity || data.timestamp;
                    const sessionAge = now - lastActivity;
                    
                    // Check if session is still valid (30 days)
                    if (sessionAge < (30 * 24 * 60 * 60 * 1000)) {
                        resultDiv.innerHTML = '<div class="test-result success">‚úÖ Auto-login berhasil: ' + data.userName + '</div>';
                        console.log('üîÑ Auto-login berhasil:', data);
                    } else {
                        resultDiv.innerHTML = '<div class="test-result warning">‚ö†Ô∏è Session expired (30 hari)</div>';
                        console.log('‚è∞ Session expired');
                    }
                } catch (error) {
                    resultDiv.innerHTML = '<div class="test-result error">‚ùå Auto-login gagal: ' + error.message + '</div>';
                }
            } else {
                resultDiv.innerHTML = '<div class="test-result warning">‚ö†Ô∏è Tidak ada data untuk auto-login</div>';
            }
        }

        // Simulate logout
        function simulateLogout() {
            const resultDiv = document.getElementById('logoutTestResult');
            
            try {
                localStorage.removeItem('userSession');
                sessionStorage.removeItem('userSession');
                
                resultDiv.innerHTML = '<div class="test-result success">‚úÖ Logout berhasil - semua data dihapus</div>';
                console.log('üö™ Simulasi logout berhasil');
                
                checkStoredData();
                refreshStorageInfo();
            } catch (error) {
                resultDiv.innerHTML = '<div class="test-result error">‚ùå Logout gagal: ' + error.message + '</div>';
            }
        }

        // Refresh storage info
        function refreshStorageInfo() {
            const localStorageInfo = document.getElementById('localStorageInfo');
            const sessionStorageInfo = document.getElementById('sessionStorageInfo');
            
            // LocalStorage info
            let localHtml = '<div>Total items: ' + localStorage.length + '</div>';
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                localHtml += '<div style="font-size: 12px; margin: 2px 0;">' + key + ': ' + (value.length > 50 ? value.substring(0, 50) + '...' : value) + '</div>';
            }
            localStorageInfo.innerHTML = localHtml;
            
            // SessionStorage info
            let sessionHtml = '<div>Total items: ' + sessionStorage.length + '</div>';
            for (let i = 0; i < sessionStorage.length; i++) {
                const key = sessionStorage.key(i);
                const value = sessionStorage.getItem(key);
                sessionHtml += '<div style="font-size: 12px; margin: 2px 0;">' + key + ': ' + (value.length > 50 ? value.substring(0, 50) + '...' : value) + '</div>';
            }
            sessionStorageInfo.innerHTML = sessionHtml;
        }

        // Clear console
        function clearConsole() {
            consoleLogsDiv.innerHTML = '';
        }

        // Check system status
        function checkSystemStatus() {
            const statusDiv = document.getElementById('systemStatus');
            let html = '<div class="test-result info">üîç Memeriksa sistem...</div>';
            
            // Check browser support
            if (typeof(Storage) !== "undefined") {
                html += '<div class="test-result success">‚úÖ Browser mendukung Web Storage</div>';
            } else {
                html += '<div class="test-result error">‚ùå Browser tidak mendukung Web Storage</div>';
            }
            
            // Check localStorage
            if (typeof(localStorage) !== "undefined") {
                html += '<div class="test-result success">‚úÖ LocalStorage tersedia</div>';
            } else {
                html += '<div class="test-result error">‚ùå LocalStorage tidak tersedia</div>';
            }
            
            // Check sessionStorage
            if (typeof(sessionStorage) !== "undefined") {
                html += '<div class="test-result success">‚úÖ SessionStorage tersedia</div>';
            } else {
                html += '<div class="test-result error">‚ùå SessionStorage tidak tersedia</div>';
            }
            
            // Check JSON support
            if (typeof(JSON) !== "undefined") {
                html += '<div class="test-result success">‚úÖ JSON support tersedia</div>';
            } else {
                html += '<div class="test-result error">‚ùå JSON support tidak tersedia</div>';
            }
            
            statusDiv.innerHTML = html;
        }

        // Initialize
        window.onload = function() {
            console.log('üß™ Test sistem login permanen dimulai');
            checkSystemStatus();
            checkStoredData();
            refreshStorageInfo();
        };
    </script>
</body>
</html>


